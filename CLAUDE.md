# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

コンテンツ販売手取り額計算WEBアプリケーション。各コンテンツ販売サイト（note、tips、Brain、ココナラコンテンツマーケット）の手数料体系を基に、販売価格から実際の手取り額を一括計算し、結果を16:9のJPEG画像として保存できるアプリです。

## 技術スタック

- **フロントエンド**: HTML5/CSS3/ES6+ (バニラJavaScript)
- **画像生成**: Canvas API
- **フォント**: Noto Sans JP
- **メインカラー**: #00c79e

## 開発コマンド

このプロジェクトは静的WEBアプリケーションのため、ビルドツールは不要です：

```bash
# 開発用ローカルサーバー起動
python -m http.server 8080
# または
npx serve .

# ファイル監視（任意）
npx live-server
```

## アーキテクチャ

### ディレクトリ構造
```
content-sales-calculator/
├── index.html              # メインページ
├── README.md              # プロジェクト説明
├── CLAUDE.md              # この文書
├── src/
│   ├── css/
│   │   ├── style.css           # メインスタイル
│   │   ├── responsive.css      # レスポンシブ対応
│   │   └── components.css      # コンポーネント別スタイル
│   ├── js/
│   │   ├── main.js            # メイン処理・イベント制御
│   │   ├── calculator.js      # 計算ロジック
│   │   ├── imageGenerator.js  # Canvas API画像生成
│   │   └── utils.js           # ユーティリティ関数
│   └── fonts/
│       └── NotoSansJP/        # Webフォントファイル
└── assets/
    └── images/
        └── favicon.ico        # ファビコン
```

### ファイル責任分離

#### JavaScript
- **main.js**: DOM操作、イベントリスナー、画面制御、UI更新
- **calculator.js**: 各プラットフォーム（note/tips/Brain/ココナラ）の手数料計算ロジック
- **imageGenerator.js**: Canvas APIを使用した16:9 JPEG画像生成機能
- **utils.js**: 数値フォーマット、入力値バリデーション、共通関数

#### CSS
- **style.css**: 基本スタイル、カラー定義、フォント設定
- **responsive.css**: ブレークポイント設定、スマートフォン対応（16:9→縦積み）
- **components.css**: UIコンポーネント（フォーム、結果表示、ボタン）

## 手数料計算仕様

### note（有料記事）
- 事務手数料: 決済手段別（5%〜15%）
- プラットフォーム利用料: 10%（事務手数料差引後に適用）
- 振込手数料: 270円

### tips
- コンテンツ販売手数料: 14%
- 振込手数料: 通常会員550円、プラス会員330円

### Brain
- コンテンツ販売手数料: 12%
- 出金手数料: 275円（税込）

### ココナラコンテンツマーケット
- 販売手数料: 22%（税込）
- 振込手数料: 3,000円未満160円、3,000円以上無料

## UI/UX仕様

### レイアウト
- **PC・タブレット**: 16:9横長レイアウト（左右2カラム）
- **スマートフォン**: 縦積みレイアウト
- 画像保存機能: Canvas APIで16:9 JPEG生成
- 作成する画像のフォーマットはassets/images/sample.jpgを参考にすること

### デザイン
- メインカラー: #00c79e
- フォント: Noto Sans JP
- レスポンシブ対応必須

## 開発手順（ステップバイステップ）

### フェーズ1: 基盤構築（1-3ステップ）

#### ステップ1: HTML構造の作成
- **ファイル**: `index.html`
- **作業内容**:
  - 基本的なHTML5構造を作成
  - meta要素（viewport、charset）の設定
  - CSS・JavaScript ファイルのリンク設定
  - 入力フォーム要素の配置
  - 計算結果表示エリアの構造化
  - 画像保存ボタンの配置

#### ステップ2: 基本CSS（メインスタイル、カラー設定）の実装
- **ファイル**: `src/css/style.css`
- **作業内容**:
  - CSS変数でメインカラー（#00c79e）とフォント（Noto Sans JP）を定義
  - 基本的なリセットCSS・ベーススタイル
  - 16:9レイアウトのベース構造（PC・タブレット用）
  - 入力フォームの基本スタイル
  - ボタンの基本スタイル

#### ステップ3: ユーティリティ関数の作成
- **ファイル**: `src/js/utils.js`
- **作業内容**:
  - 数値フォーマット関数（カンマ区切り表示）
  - 入力値バリデーション関数（数値チェック、範囲チェック）
  - XSS対策のためのサニタイズ関数
  - エラーハンドリング関数

### フェーズ2: 計算機能実装（4-6ステップ）

#### ステップ4: 手数料計算ロジックの実装
- **ファイル**: `src/js/calculator.js`
- **作業内容**:
  - noteの計算関数（決済方法別の事務手数料 + プラットフォーム利用料10% + 振込手数料270円）
  - tipsの計算関数（販売手数料14% + 振込手数料）
  - Brainの計算関数（販売手数料12% + 出金手数料275円）
  - ココナラコンテンツマーケットの計算関数（販売手数料22% + 振込手数料）
  - 全プラットフォーム統合計算関数

#### ステップ5: 入力バリデーション機能の実装
- **ファイル**: `src/js/utils.js`の拡張
- **作業内容**:
  - 数値以外の入力を防止する関数
  - 負の値や0の値の処理
  - 無効な入力時のエラー表示機能
  - リアルタイムバリデーション

#### ステップ6: DOM操作とイベント処理の実装
- **ファイル**: `src/js/main.js`
- **作業内容**:
  - DOMContentLoadedイベントリスナー
  - 計算ボタンのクリックイベント処理
  - 入力フィールドの変更イベント処理
  - 計算結果の画面表示処理
  - エラー表示・クリア機能

### フェーズ3: UI/UX実装（7-9ステップ）

#### ステップ7: レスポンシブデザインの実装
- **ファイル**: `src/css/responsive.css`
- **作業内容**:
  - スマートフォン用ブレークポイント設定
  - 16:9横長レイアウト → 縦積みレイアウトへの変換
  - フォントサイズ・余白の調整
  - タッチデバイス対応（ボタンサイズ等）

#### ステップ8: 結果表示機能の実装
- **ファイル**: `src/css/components.css`, `src/js/main.js`の拡張
- **作業内容**:
  - 計算結果表示エリアのスタイリング
  - 左側カラム（note各決済方法）のレイアウト
  - 右側カラム（tips, Brain, ココナラ）のレイアウト
  - 手数料内訳の表示形式
  - 手取り額の強調表示

#### ステップ9: Canvas API画像生成機能の実装
- **ファイル**: `src/js/imageGenerator.js`
- **作業内容**:
  - 16:9アスペクト比のCanvasを作成
  - テキスト描画機能（Noto Sans JP フォント使用）
  - レイアウト構成（左右2カラム配置）
  - JPEG形式でのダウンロード機能
  - 画像保存ボタンのイベント処理

### フェーズ4: 最適化・テスト（10-12ステップ）

#### ステップ10: クロスブラウザ対応とテスト
- **作業内容**:
  - Chrome, Firefox, Safari, Edge での動作確認
  - Canvas API の互換性チェック
  - スマートフォンでの実機テスト
  - 計算精度の検証

#### ステップ11: パフォーマンス最適化
- **作業内容**:
  - Webフォントの最適化（フォントサブセット化）
  - 不要なCSSの削除
  - JavaScript の最適化
  - 画像ファイルの最適化

#### ステップ12: セキュリティ検証
- **作業内容**:
  - XSS脆弱性チェック
  - 入力値サニタイゼーションの確認
  - CSP（Content Security Policy）の設定検討
  - 最終的な動作確認

### 実装優先度
1. **高優先度**: ステップ1-6（基本機能の実装）
2. **中優先度**: ステップ7-9（UI/UX の充実）
3. **低優先度**: ステップ10-12（最適化・品質向上）

### 各ステップの所要時間目安
- フェーズ1: 2-3時間
- フェーズ2: 4-5時間
- フェーズ3: 3-4時間
- フェーズ4: 2-3時間

**総開発時間**: 約11-15時間